<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç—ã ‚Ä¢ Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è Leaflet –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
        .leaflet-container {
            background: #1a1a1a;
            font-family: 'Inter', sans-serif;
        }
        .leaflet-control-zoom a {
            background: rgba(40, 40, 40, 0.95) !important;
            color: #ffffff !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(10px);
        }
        .leaflet-control-zoom a:hover {
            background: rgba(60, 60, 60, 0.95) !important;
        }
        .leaflet-popup-content-wrapper {
            background: rgba(40, 40, 40, 0.95) !important;
            color: #ffffff !important;
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .leaflet-popup-tip {
            background: rgba(40, 40, 40, 0.95) !important;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <nav class="navbar">
            <div class="nav-brand">–ö–∞—Ä—Ç—ã</div>
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="map">–ö–∞—Ä—Ç–∞</button>
                <button class="nav-tab" data-tab="favorites">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
                <button class="nav-tab" data-tab="categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
                <button class="nav-tab" data-tab="business">–ë–∏–∑–Ω–µ—Å</button>
            </div>
        </nav>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã -->
        <main class="main-content">
            <div id="map" class="map-container"></div>

            <!-- –ü–æ–∏—Å–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="search-container">
                <div class="search-box">
                    <input type="text" placeholder="–ü–æ–∏—Å–∫ –º–µ—Å—Ç–∞ –∏–ª–∏ –∞–¥—Ä–µ—Å–∞..." class="search-input" id="search-input">
                    <button class="search-btn" id="search-btn">üîç</button>
                </div>
            </div>

            <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="map-controls">
                <button class="control-btn zoom-in" id="zoom-in">+</button>
                <button class="control-btn zoom-out" id="zoom-out">‚àí</button>
                <button class="control-btn fullscreen" id="fullscreen">‚õ∂</button>
                <button class="control-btn location" id="location">üìç</button>
            </div>

            <!-- –§–∏–ª—å—Ç—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
            <div class="categories-panel">
                <div class="category-filters">
                    <button class="category-filter active" data-category="all">–í—Å–µ</button>
                    <button class="category-filter" data-category="cafe">üç¥ –ö–∞—Ñ–µ</button>
                    <button class="category-filter" data-category="restaurant">üç∑ –†–µ—Å—Ç–æ—Ä–∞–Ω—ã</button>
                    <button class="category-filter" data-category="shop">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω—ã</button>
                    <button class="category-filter" data-category="park">üå≥ –ü–∞—Ä–∫–∏</button>
                </div>
            </div>
        </main>

        <!-- –ë–æ—Ç—Ç–æ–º-—à–∏—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–µ—Å—Ç–µ -->
        <div class="bottom-sheet">
            <div class="bottom-sheet-handle"></div>
            <div class="bottom-sheet-content">
                <div class="place-info">
                    <h3 class="place-name">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–µ</h3>
                    <p class="place-address">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
        <div class="modal categories-modal" id="categories-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="categories-grid">
                    <div class="category-card" data-category="cafe">
                        <div class="category-icon">üç¥</div>
                        <span>–ö–∞—Ñ–µ</span>
                    </div>
                    <div class="category-card" data-category="restaurant">
                        <div class="category-icon">üç∑</div>
                        <span>–†–µ—Å—Ç–æ—Ä–∞–Ω—ã</span>
                    </div>
                    <div class="category-card" data-category="shop">
                        <div class="category-icon">üõçÔ∏è</div>
                        <span>–ú–∞–≥–∞–∑–∏–Ω—ã</span>
                    </div>
                    <div class="category-card" data-category="park">
                        <div class="category-icon">üå≥</div>
                        <span>–ü–∞—Ä–∫–∏</span>
                    </div>
                    <div class="category-card" data-category="hotel">
                        <div class="category-icon">üè®</div>
                        <span>–û—Ç–µ–ª–∏</span>
                    </div>
                    <div class="category-card" data-category="pharmacy">
                        <div class="category-icon">üíä</div>
                        <span>–ê–ø—Ç–µ–∫–∏</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function initMap() {
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —Å —Ü–µ–Ω—Ç—Ä–æ–º –≤ –ú–æ—Å–∫–≤–µ
            const map = L.map('map', {
                zoomControl: false,
                attributionControl: false
            }).setView([55.7558, 37.6173], 13);

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π OpenStreetMap —Å —Ç—ë–º–Ω–æ–π —Ç–µ–º–æ–π
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            // –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            const customIcons = {
                cafe: L.divIcon({
                    html: 'üç¥',
                    className: 'custom-marker cafe-marker',
                    iconSize: [30, 30]
                }),
                restaurant: L.divIcon({
                    html: 'üç∑',
                    className: 'custom-marker restaurant-marker',
                    iconSize: [30, 30]
                }),
                shop: L.divIcon({
                    html: 'üõçÔ∏è',
                    className: 'custom-marker shop-marker',
                    iconSize: [30, 30]
                }),
                park: L.divIcon({
                    html: 'üå≥',
                    className: 'custom-marker park-marker',
                    iconSize: [30, 30]
                })
            };

            // –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –º–µ—Å—Ç
            const places = [
                { lat: 55.7558, lng: 37.6176, name: "–ö–æ—Ñ–µ–π–Ω—è Central", type: "cafe", address: "—É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 1" },
                { lat: 55.7578, lng: 37.6178, name: "–†–µ—Å—Ç–æ—Ä–∞–Ω Pushkin", type: "restaurant", address: "—É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 5" },
                { lat: 55.7538, lng: 37.6190, name: "–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä", type: "shop", address: "—É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 10" },
                { lat: 55.7598, lng: 37.6150, name: "–ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ", type: "park", address: "–ö—Ä—ã–º—Å–∫–∏–π –≤–∞–ª, 9" }
            ];

            // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã –Ω–∞ –∫–∞—Ä—Ç—É
            places.forEach(place => {
                const marker = L.marker([place.lat, place.lng], { 
                    icon: customIcons[place.type] 
                }).addTo(map);
                
                marker.bindPopup(`
                    <div class="place-popup">
                        <h4>${place.name}</h4>
                        <p>${place.address}</p>
                        <div class="popup-actions">
                            <button class="popup-btn favorite">‚ù§Ô∏è</button>
                            <button class="popup-btn route">üö∂</button>
                        </div>
                    </div>
                `);
            });

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            document.getElementById('zoom-in').addEventListener('click', () => {
                map.zoomIn();
            });

            document.getElementById('zoom-out').addEventListener('click', () => {
                map.zoomOut();
            });

            document.getElementById('location').addEventListener('click', () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition((position) => {
                        const { latitude, longitude } = position.coords;
                        map.setView([latitude, longitude], 15);
                    });
                }
            });

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            document.querySelectorAll('.category-filter').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.category-filter').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    const category = this.dataset.category;
                    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –º–∞—Ä–∫–µ—Ä–æ–≤
                });
            });

            // –ü–æ–∏—Å–∫
            document.getElementById('search-btn').addEventListener('click', performSearch);
            document.getElementById('search-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });

            function performSearch() {
                const query = document.getElementById('search-input').value;
                if (query) {
                    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–æ–∏—Å–∫–æ–≤—ã–º —Å–µ—Ä–≤–∏—Å–æ–º Nominatim
                    console.log('–ü–æ–∏—Å–∫:', query);
                }
            }

            return map;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            const map = initMap();
            
            // –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // –ë–æ—Ç—Ç–æ–º-—à–∏—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ
            const bottomSheet = document.querySelector('.bottom-sheet');
            let startY = 0;
            let currentY = 0;

            bottomSheet.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
            });

            bottomSheet.addEventListener('touchmove', (e) => {
                currentY = e.touches[0].clientY;
                const diff = startY - currentY;
                if (diff > 0) {
                    bottomSheet.style.transform = `translateY(-${diff}px)`;
                }
            });

            bottomSheet.addEventListener('touchend', () => {
                bottomSheet.style.transform = '';
            });
        });
    </script>
</body>
</html>
